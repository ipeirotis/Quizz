package us.quizz.entities;

import com.googlecode.objectify.annotation.Cache;
import com.googlecode.objectify.annotation.Entity;
import com.googlecode.objectify.annotation.Id;
import com.googlecode.objectify.annotation.Index;

import java.io.Serializable;
import java.text.NumberFormat;
import java.util.Date;

@Entity
@Cache
@Index
public class ExplorationExploitationResult  implements Serializable {
  private static final long serialVersionUID = 1L;

  @Id
  private String id;
  // Number of correct calibration answers
  private Integer a;
  // Number of incorrect calibration answers
  private Integer b;
  // Number of exploit actions
  private Integer c;
  // The expected utility of the next action
  private double utility;
  // Number of forward steps followed until reaching that decision
  private int iterations;
  // Whether the next action should be the serving of an exploit question
  private Boolean actionExploit;
  // The expected utility of exploring (ie. serving a calibration question)
  private Double exploreUtility;
  // The expected utility of exploiting (ie. serving a collection question)
  private Double exploitUtility;
  // Last time that we computed the object
  private Date timestamp;

  public ExplorationExploitationResult() {
    this.a = -1;
    this.b = -1;
    this.c = -1;
    this.actionExploit=false;
    this.id = generateId(a, b, c);
  }

  public ExplorationExploitationResult(Integer a, Integer b, Integer c) {
    this.a = a;
    this.b = b;
    this.c = c;
    this.id = generateId(a, b, c);
  }

  public static String generateId(Integer a, Integer b, Integer c) {
    return a + "_" + b + "_" + c;
  }

  public Date getTimestamp() {
    return timestamp;
  }

  public void setTimestamp(Date timestamp) {
    this.timestamp = timestamp;
  }

  public Integer getA() {
    return a;
  }

  public Boolean getActionExploit() {
    return actionExploit;
  }

  public Integer getB() {
    return b;
  }

  public Integer getC() {
    return c;
  }

  public Double getExploitUtility() {
    return exploitUtility;
  }

  public Double getExploreUtility() {
    return exploreUtility;
  }

  public int getIterations() {
    return iterations;
  }

  public double getUtility() {
    return utility;
  }

  public String print() {
    NumberFormat format = NumberFormat.getInstance();
    format.setMinimumFractionDigits(4);
    format.setMaximumFractionDigits(4);

    StringBuffer sb = new StringBuffer();
    sb.append("[" + a + "," + b + "," + c + "]: V=");
    sb.append(format.format(this.utility));
    sb.append("/R=");
    sb.append(format.format(this.exploreUtility));
    sb.append("/T=");
    sb.append(format.format(this.exploitUtility));
    sb.append("/Exploit=");
    sb.append(this.actionExploit + "\t");
    sb.append("/Iter=");
    sb.append(this.iterations + "\t");
    sb.append("/Time=");
    sb.append(this.timestamp.toString() + "\n");

    return sb.toString();
  }

  public void setA(Integer a) {
    this.a = a;
  }

  public void setActionExploit(Boolean actionExploit) {
    this.actionExploit = actionExploit;
  }

  public void setB(Integer b) {
    this.b = b;
  }

  public void setC(Integer c) {
    this.c = c;
  }

  public void setExploitUtility(Double exploitUtility) {
    this.exploitUtility = exploitUtility;
  }

  public void setExploreUtility(Double exploreUtility) {
    this.exploreUtility = exploreUtility;
  }

  public void setIterations(int iterations) {
    this.iterations = iterations;
  }

  public void setUtility(double utility) {
    this.utility = utility;
  }

  public String getId() {
    return id;
  }

  public void setId(String id) {
    this.id = id;
  }
}
